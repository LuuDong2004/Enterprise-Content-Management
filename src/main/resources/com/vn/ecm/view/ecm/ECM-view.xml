<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<view xmlns="http://jmix.io/schema/flowui/view"
      title="msg://ecmView.title">
    <data>
        <collection id="foldersDc" class="com.vn.ecm.entity.Folder">
            <fetchPlan>
                <property name="name"/>
                <property name="parent"/>
                <property name="sourceStorage"/>
                <property name="deleteDate"/>
                <property name="deletedBy"/>
                <property name="inTrash"/>
                <property name="fullPath"/>
                <property name="createdDate"/>
            </fetchPlan>
            <loader id="foldersDl">
                <query><![CDATA[
                select f from Folder f
                where f.sourceStorage = :storage
                and f.inTrash = false
            ]]></query>
            </loader>
        </collection>
        <collection id="filesDc" class="com.vn.ecm.entity.FileDescriptor">
            <fetchPlan>
                <property name="name"/>
                <property name="extension"/>
                <property name="size"/>
                <property name="lastModified"/>
                <property name="folder"/>
                <property name="fileRef"/>
                <property name="inTrash"/>
                <property name="deletedBy"/>
                <property name="deleteDate"/>
            </fetchPlan>
            <loader id="filesDl">
                <query><![CDATA[
                select f from FileDescriptor f
                where f.sourceStorage = :storage
                and (:folder is null or f.folder = :folder)
                and f.inTrash = false
            ]]></query>
            </loader>
        </collection>
        <collection id="StorageDc" class="com.vn.ecm.entity.SourceStorage">
            <loader id="storagesDl">
                <query>
                    <![CDATA[
                        select s from SourceStorage s
                        where s.active = true
                    ]]>
                </query>
            </loader>

        </collection>
    </data>
    <actions>
        <action id="uploadAction"   type="UploadDownloadFile"/>
        <action id="downloadAction" type="UploadDownloadFile"/>
    </actions>
    <layout>
        <split width="100%" height="100%">
            <!--            left-->
            <vbox width="100%" height="100%">
                <treeDataGrid id="foldersTree"
                              dataContainer="foldersDc"
                              hierarchyProperty="parent"
                              width="100%"
                              minHeight="100%" themeNames="compact">
                    <columns>
                        <column property="name"/>
                    </columns>
                    <actions>
                        <action id="createFolder" text="Tạo thư mục"/>
                        <action id="delete" text="Xóa" type="folderActionSelected"/>
                        <action id="renameFolder" text="Đổi tên" type="folderActionSelected"/>
                        <action id="assignPermission" text="Phân quyền" type="assignPermission"/>
                    </actions>
                </treeDataGrid>
            </vbox>
            <!--right-->
            <vbox classNames="right" width="100%" height="100%">
                <hbox id="rightHbox"
                      spacing="true"
                      width="100%"
                      alignItems="CENTER">

                    <fileStorageUploadField id="fileRefField"
                                            property="fileRef"
                                            uploadText="Tải lên"
                                            dropAllowed="true"
                                            clearButtonVisible="true"
                                            maxFileSize="1073741824"
                                            fileStoragePutMode="MANUAL"/>
                    <button id="btnDownload" text="Tải xuống" action="downloadAction"/>
                    <fragment id="viewModeFragment" class="com.vn.ecm.view.viewmode.ViewModeFragment"/>
                </hbox>
                <hbox id="iconTiles" visible="false" classNames="icon-tiles"/>
                <dataGrid id="fileDataGird"
                          width="100%"
                          minHeight="20em"
                          dataContainer="filesDc" themeNames="compact">
                    <actions>
                        <action id="deleteFile" type="fileActionSelected" text="Xóa"/>
                        <action id="renameFile" type="fileActionSelected" text="Đổi tên"/>
                        <action id="onObjectAssignPermission" text="Phân quyền" type="onObjectAssignPermission"/>
                    </actions>
                    <columns>
                        <column property="name" header="Tên"/>
                        <column property="size" header="Kích thước"/>
                        <column property="extension" header="Kiểu"/>
                        <column property="lastModified" header="Ngày tạo"/>
                    </columns>
                </dataGrid>
            </vbox>

        </split>

    </layout>
</view>