<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<view xmlns="http://jmix.io/schema/flowui/view"
      title="Kho lưu trữ">
    <data>
        <collection id="foldersDc" class="com.vn.ecm.entity.Folder">
            <fetchPlan>
                <property name="name"/>
                <property name="parent"/>
                <property name="sourceStorage"/>
            </fetchPlan>
            <loader id="foldersDl">
                <query><![CDATA[
                select f from Folder f
                where f.sourceStorage = :storage
            ]]></query>
            </loader>
        </collection>
        <collection id="filesDc" class="com.vn.ecm.entity.FileDescriptor">
            <fetchPlan>
                <property name="name"/>
                <property name="extension"/>
                <property name="size"/>
                <property name="lastModified"/>
                <property name="folder"/>
                <property name="fileRef"/>
            </fetchPlan>
            <loader id="filesDl">
                <query><![CDATA[
                select f from FileDescriptor f
                where f.sourceStorage = :storage
                and (:folder is null or f.folder = :folder)
            ]]></query>
            </loader>
        </collection>
        <collection id="StorageDc" class="com.vn.ecm.entity.SourceStorage">
            <loader id="storagesDl">
                <query>
                    <![CDATA[
                        select s from SourceStorage s
                        where s.active = true
                    ]]>
                </query>
            </loader>
        </collection>
    </data>

    <layout>
        <split width="100%" height="100%">
            <!--left-->
            <vbox width="100%" height="100%">
                <treeDataGrid id="foldersTree"
                              dataContainer="foldersDc"
                              hierarchyProperty="parent"
                              width="100%"
                              minHeight="100%">
                    <columns>
                        <column property="name" header="Thư mục"/>
                    </columns>
                    <actions>
                        <action id="createFolder" text="Tạo thư mục"/>
                        <action id="delete" text="Xóa"/>
                        <action id="rename" text="Đổi tên"/>
                        <action id="assignPermission" text="Phân quyền" type="assignPermission"/>
                    </actions>
                </treeDataGrid>
            </vbox>

            <!--right-->
            <vbox classNames="right" width="100%" height="100%">
                <hbox id="rightHbox"
                      spacing="true"
                      width="100%"
                      alignItems="CENTER">
                    <fileStorageUploadField id="fileRefField"
                                            uploadText="Tải lên"
                                            property="fileRef"
                                            dropAllowed="true"
                                            clearButtonVisible="true"
                                            maxFileSize="1073741824"
                                            fileStoragePutMode="MANUAL"/>
                    <button id="btnDownload"
                            text="Tải xuống"/>
                </hbox>
                <dataGrid id="fileDataGird"
                          width="100%"
                          minHeight="20em"
                          dataContainer="filesDc">
                    <actions>
                        <action id="deleteFile" text="Xóa"/>
                        <action id="onObjectAssignPermission" text="Phân quyền" type="onObjectAssignPermission"/>
                    </actions>
                    <columns>
                        <column property="name" header="Tên"/>
                        <column property="lastModified" header="Ngày tạo"/>
                        <column property="extension" header="Kiểu dữ liệu"/>
                        <column property="size" header="Kích thước"/>
                    </columns>
                </dataGrid>
            </vbox>

        </split>

    </layout>
</view>