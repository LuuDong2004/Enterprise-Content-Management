<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<view xmlns="http://jmix.io/schema/flowui/view"
      title="msg://UserListView.title"
      focusComponent="objectDataGrid">

    <data>
        <collection id="objectsDc"
                    class="com.vn.ecm.entity.EcmObject">
            <fetchPlan extends="_base"/>
        </collection>

        <!-- Loader Users để controller gọi -->
        <collection id="usersDc"
                    class="com.vn.ecm.entity.User">
            <fetchPlan extends="_base"/>
            <loader id="usersDl" readOnly="true">
                <query>
                    <![CDATA[select e from User e order by e.username]]>
                </query>
            </loader>
        </collection>

        <!-- Loader Roles để controller gọi -->
        <collection id="rolesDc"
                    class="io.jmix.securitydata.entity.ResourceRoleEntity">
            <fetchPlan extends="_base"/>
            <loader id="rolesDl" readOnly="true">
                <query>
                    <![CDATA[select r from sec_ResourceRoleEntity r order by r.name]]>
                </query>
            </loader>
        </collection>

        <!-- Loader Permissions phục vụ reload sau khi Apply -->
        <collection id="permissionsDc"
                    class="com.vn.ecm.entity.Permission">
            <fetchPlan extends="_base"/>
            <loader id="permissionsDl" readOnly="true">
                <query>
                    <![CDATA[
                        select p from Permission p
                        where (:file is null or p.file = :file)
                          and (:folder is null or p.folder = :folder)
                          and (:user is null or p.user = :user)
                          and (:roleCode is null or p.roleCode = :roleCode)
                    ]]>
                </query>
            </loader>
        </collection>
    </data>

    <facets>
        <dataLoadCoordinator auto="false"/>
    </facets>

    <layout>
        <hbox id="toolbar" classNames="buttons-panel" alignItems="center" spacing="true">
            <textArea id="pathArea" width="45%" readOnly="true"/>

            <label text="Hiển thị:"/>
            <checkbox id="usersFilterCb" label="Người dùng"/>
            <checkbox id="rolesFilterCb" label="Nhóm"/>

            <button id="applyBtn" text="Áp dụng" themeNames="primary"/>
        </hbox>

        <dataGrid id="objectDataGrid"
                  width="100%"
                  minHeight="24em"
                  columnReorderingAllowed="true"
                  dataContainer="objectsDc">
            <columns resizable="true">
                <!-- Cột "Thêm" sẽ được thêm bằng ComponentRenderer trong onInit() -->
                <column property="name" header="Tên"/>
                <column property="type" header="Loại"/>
            </columns>
        </dataGrid>
    </layout>
</view>